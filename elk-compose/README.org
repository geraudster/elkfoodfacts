* Docker Compose for Elastic stack

** Installation

For the first time, clone this repository, _cd_ into it, then:

#+BEGIN_SRC bash
# Generate certificates
docker-compose -f docker-compose-create-certs.yml run --rm create_certs

# Start elasticsearch
docker-compose up -d elasticsearch

# Generate passwords
docker-compose -f docker-compose-create-certs.yml run --rm init_passwords

# Start kibana
docker-compose up -d kibana
#+END_SRC

Try to open kibana UI: https://localhost:5601 (default credentials: elastic/ELASTIC_PASSWORD)

** Usage

After installing, use the following command to start:

#+BEGIN_SRC bash
docker-compose up -d
#+END_SRC

Use the following command to stop:

#+BEGIN_SRC bash
docker-compose stop
#+END_SRC

For logstash, put conf files in _pipeline_ directory, they will be
executed in alphabetical order. You can also put data files in _data_ directory.
Then you can stop/start logstash:

#+BEGIN_SRC bash
docker-compose stop logstash
docker-compose up logstash
#+END_SRC

** Troubleshoot

You may fall on the following error when starting ElasticSearch:

#+BEGIN_SRC bash
max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]
#+END_SRC

Just set the parameter accordingly: 

#+BEGIN_SRC bash
sudo sysctl -w vm.max_map_count=262144
#+END_SRC
